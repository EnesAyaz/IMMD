function [Cseri,Cap,Wcap,Hcap,Lcap,Icap,ESR,Gcap,Ccap] = capacitor_selection(Cdcm,Irms,Vdcm)
global Tamb
global Tcamax
% columns:
% 1. capacitance (uF) ***
% 2. width (mm) ***
% 3. height (mm) ***
% 4. length (mm) ***
% 5. Irms (A), 10kHz, 70C ***
% 6. ESR (mOhm), 10kHz, 70C ***
% 7. ESL (nH)
% 8. tan_delta, 1kHz
% 9. tan_delta, 10kHz
% 10. MOQ
% 11. Heat coefficient (mW/C) ***
% 12. lead spacing (mm)
% 13. Cost ***

fpc_300v = [
    2.2 11.0 19.0 31.5 5.0 18.1 16.0 0.7 4.1 1280 25 27.5 2.25
    3.3 12.5 21.5 31.5 7.0 12.2 19.0 0.7 4.1 1120 30 27.5 2.74
    4.7 14.0 24.5 31.5 8.5 8.9 21.0 0.7 4.2 1040 35 27.5 3.13
    5.0 15.0 24.5 31.5 9.0 8.4 21.0 0.7 4.2 960 36 27.5 3.29
    6.8 18.0 27.5 31.5 11.5 6.3 24.0 0.7 4.4 800 44 27.5 3.82
    8.0 16.0 32.0 31.5 12.5 5.6 27.0 0.7 4.5 880 45 27.5 4.32
    8.2 18.0 33.0 31.5 13.0 5.5 27.0 0.7 4.5 800 48 27.5 4.47
    10.0 21.0 31.0 31.5 14.5 4.6 27.0 0.8 4.6 720 51 27.5 4.76
    12.0 22.0 36.5 31.5 17.0 4.0 31.0 0.8 4.9 640 58 27.5 5.33
    15.0 20.0 39.5 42.0 16.0 5.4 10.0 1.1 8.3 640 72 37.5 5.78
    20.0 28.0 37.0 42.0 20.0 4.0 11.0 1.1 8.4 440 83 37.5 7.6
    20.0 43.0 22.0 41.5 19.5 4.0 13.0 1.1 8.3 280 80 37.5 7.6
    22.0 28.0 42.5 42.0 21.5 3.8 11.0 1.2 8.5 440 90 37.5 7.63
    25.0 28.0 42.5 42.0 22.5 3.4 12.0 1.2 8.6 440 90 37.5 7.85
    30.0 30.0 45.0 42.0 26.0 2.8 12.0 1.2 8.7 400 100 37.5 9.07
    35.0 33.0 48.0 42.0 29.5 2.5 13.0 1.2 8.8 180 110 37.5 9.97
    40.0 30.0 45.0 57.5 28.0 3.0 12.0 1.5 12.3 280 125 52.5 10.68
    47.0 35.0 50.0 57.5 33.0 2.6 13.0 1.5 12.5 108 145 52.5 11.72
    60.0 35.0 50.0 57.5 37.0 2.1 15.0 1.6 12.9 108 145 52.5 12.70
    80.0 45.0 57.0 57.5 47.0 1.6 18.0 1.6 13.5 140 185 52.5 14.15
    80.0 130.0 24.0 57.5 51.0 1.4 4.0 1.5 11.7 80 200 52.5 14.15
    100.0 60.0 45.0 57.5 48.0 1.4 19.0 1.6 13.5 200 192 52.5 15.51
    ];

% 1 dummy capacitor is added
fpc_450v = [
    1.5 11.0 19.0 31.5 4.5 22.1 16.0 0.6 3.3 1280 25 27.5 1.78
    2.2 12.5 21.5 31.5 6.0 14.9 19.0 0.6 3.3 1120 30 27.5 1.81
    3.3 15.0 24.5 31.5 8.0 10.3 22.0 0.6 3.4 960 36 27.5 3.14
    4.7 18.0 27.5 31.5 10.5 7.5 24.0 0.6 3.5 800 44 27.5 3.75
    5.0 16.0 32.0 31.5 11.0 7.1 28.0 0.7 3.6 880 45 27.5 4.38
    5.6 18.0 33.0 31.5 12.0 6.3 29.0 0.7 3.6 800 48 27.5 4.42
    6.0 21.0 31.0 31.5 13.0 5.9 28.0 0.7 3.6 720 51 27.5 4.32
    6.8 22.0 36.5 31.5 14.5 5.4 29.0 0.7 3.7 640 58 27.5 4.54
    7.5 22.0 36.5 31.5 15.0 5.0 32.0 0.7 3.8 640 58 27.5 4.85
    8.2 20.0 39.5 42.0 13.5 7.8 9.0 1.0 6.7 640 72 37.5 5.14
    10.0 20.0 39.5 42.0 14.5 6.4 11.0 1.0 6.7 640 72 37.5 6.50
    13.0 43.0 22.0 41.5 17.5 5.0 13.0 1.0 6.6 280 80 37.5 8.01
    15.0 28.0 42.5 42.0 20.0 4.4 11.0 1.0 6.8 440 90 37.5 9.40
    20.0 30.0 45.0 42.0 24.0 3.3 13.0 1.0 6.9 400 100 37.5 10.09
    25.0 33.0 48.0 42.0 28.0 2.8 14.0 1.0 7.1 180 110 37.5 12.03
    30.0 35.0 50.0 57.5 28.0 3.2 14.0 1.3 9.9 108 145 52.5 13.65
    35.0 35.0 50.0 57.5 31.5 2.8 14.0 1.3 10.0 108 145 52.5 14.53
    40.0 35.0 50.0 57.5 34.0 2.5 15.0 1.3 10.2 108 145 52.5 15.05
    60.0 45.0 57.0 57.5 45.0 1.8 18.0 1.4 11.2 140 185 52.5 17.28
    60.0 130.0 24.0 57.5 49.5 1.6 4.0 1.2 9.5 80 200 52.5 18.15
    65.0 60.0 45.0 57.5 48.0 1.6 19.0 1.3 10.6 200 192 52.5 19.01
    180.0 130.0 58.0 57.5 97.5 0.6 6.0 1.4 11.2 40 300 52.5 45.60
    ];

if Vdcm >= 400
    prisel = 0; % select 2 series connected 300 V capacitor
    cap_data = fpc_300v;
elseif Vdcm >= 250 && Vdcm < 400
    prisel = 1; % select one 450V capacitor
    cap_data = fpc_450v;
elseif Vdcm <= 250
    prisel = 2; % select one 300V capacitor
    cap_data = fpc_300v;
end
capnum = numel(cap_data);
for k = 1:capnum
    if prisel ~= 0
        if Cdcm <= cap_data(k,1) && Irms <= cap_data(k,5)
            ESR = cap_data(k,6); % mOhm
            Gcap = cap_data(k,11); % mW/C
            Plosscap1 = Irms^2*ESR; % mW
            Tca = Plosscap1/Gcap + Tamb;
            if Tca <= Tcamax
                Cseri = 1;
                break;
            else
                Cdcm = cap_data(k,1) + 1;
            end
        end
    end
    if prisel == 0
        if Cdcm <= cap_data(k,1)/2 && Irms <= cap_data(k,5)
            ESR = cap_data(k,6); % mOhm
            Gcap = cap_data(k,11); % mW/C
            Plosscap1 = Irms^2*ESR; % mW
            Tca = Plosscap1/Gcap + Tamb;
            if Tca <= Tcamax
                Cseri = 2;
                break;
            else
                Cdcm = cap_data(k,1) + 1;
            end
        end
    end
    
end

% Capacitor data:
% Cseri, Capacitance, Wcap, Hcap, Lcap, Current, ESR, Gcap, Cost
%capacitor_data = [Cseri,cap_data(k,1),cap_data(k,2),...
%    cap_data(k,3),cap_data(k,4),cap_data(k,5),...
%    cap_data(k,6),cap_data(k,13)];
Cap = cap_data(k,1);
Wcap = cap_data(k,2);
Hcap = cap_data(k,3);
Lcap = cap_data(k,4);
Icap = cap_data(k,5);
Ccap = cap_data(k,13);

end